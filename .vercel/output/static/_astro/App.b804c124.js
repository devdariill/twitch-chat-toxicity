import{r as R}from"./index.45a47ed6.js";var ve=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Be(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var s=function i(){if(this instanceof i){var o=[null];o.push.apply(o,arguments);var a=Function.bind.apply(e,o);return new a}return e.apply(this,arguments)};s.prototype=e.prototype}else s={};return Object.defineProperty(s,"__esModule",{value:!0}),Object.keys(t).forEach(function(i){var o=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(s,i,o.get?o:{enumerable:!0,get:function(){return t[i]}})}),s}const Se="https://andocarbur.com/api/twitch",Fe=30,ce=["#3498db","#2ecc71","#9b59b6","#f1c40f","#e67e22","#e74c3c","#5f27cd","#ff9ff3","#00d2d3","#2e86de","#A3CB38","#1B1464"];async function Ve(t){return await(await fetch(`${Se}/userinfo?userName=${t}`)).json()}var u={},Ae={get exports(){return u},set exports(t){u=t}},te={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xe=R,Ye=Symbol.for("react.element"),Qe=Symbol.for("react.fragment"),Ze=Object.prototype.hasOwnProperty,Ke=Xe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,et={key:!0,ref:!0,__self:!0,__source:!0};function Pe(t,e,s){var i,o={},a=null,l=null;s!==void 0&&(a=""+s),e.key!==void 0&&(a=""+e.key),e.ref!==void 0&&(l=e.ref);for(i in e)Ze.call(e,i)&&!et.hasOwnProperty(i)&&(o[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)o[i]===void 0&&(o[i]=e[i]);return{$$typeof:Ye,type:t,key:a,ref:l,props:o,_owner:Ke.current}}te.Fragment=Qe;te.jsx=Pe;te.jsxs=Pe;(function(t){t.exports=te})(Ae);function be({userName:t}){const[e,s]=R.useState({isOnline:!1,avatarUrl:"/favicon.svg",loading:!0,error:null}),i=e.isOnline?"green":"red";R.useEffect(()=>{(async()=>{const v=await Ve(t);s(v)})()},[]);const o=u.jsx("img",{className:"h-10 w-10 rounded-full object-cover border-2",style:{borderColor:i},src:e.avatarUrl,alt:t}),a=u.jsx("span",{className:"block ml-2 font-bold text-base text-gray-600",children:t}),l=u.jsxs("span",{className:"flex ml-2",style:{color:i},children:[u.jsx("svg",{height:"12",width:"12",children:u.jsx("circle",{cx:"6",cy:"6",r:"5",fill:"currentColor"})}),u.jsx("p",{className:"px-1 text-[11px]",children:e.isOnline?"Online":"Offline"})]}),p=u.jsx("div",{className:"flex items-center border-b border-gray-300 pl-3 py-3",children:u.jsxs("div",{className:"flex items-center w-full space-x-2",children:[u.jsx("div",{className:"h-10 w-10 bg-gray-200 rounded-full dark:bg-gray-700"}),u.jsx("div",{className:"h-6 w-[300px] bg-gray-300 rounded-full "})]})}),c=u.jsxs("div",{className:"flex items-center border-b border-gray-300 pl-3 py-3",children:[o,u.jsxs("span",{children:[a,l]})]}),g=u.jsxs("div",{id:"alert-border-2",className:"flex p-2 mb-2 text-red-800 border-t-4 border-red-300 bg-red-50 dark:text-red-400 dark:bg-gray-800 dark:border-red-800",role:"alert",children:[u.jsx("svg",{className:"flex-shrink-0 w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:u.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),u.jsx("div",{className:"ml-3 text-sm font-medium",children:e.error})]});return e.loading?p:e.error?g:c}function tt({message:t}){let e="";if(t.classified.isToxic)switch(t.classified.toxicLevel){case"hight":e="bg-[#e74c3c]";break;case"medium":e="bg-[#e67e22]";break;default:e="bg-[#f1c40f]";break}const s=u.jsx("p",{className:"text-[16px]",children:t.classified.isToxic?u.jsx("span",{children:"☣️"}):u.jsx("span",{children:"✔️"})}),i=u.jsx("span",{className:"font-semibold",style:{color:t.color},children:t.userName});return u.jsx("li",{className:"clearfix2",children:u.jsxs("div",{className:`text-[14px] py-1 px-2 rounded hover:bg-gray-500/30 leading-6 ${e}`,children:[u.jsx("div",{className:"inline-flex items-baseline",children:s}),u.jsx("div",{className:"pl-2 inline-flex items-baseline",children:i}),u.jsx("span",{className:"ml-3 break-words",children:t.message})]})})}function st({messages:t}){const e=R.useRef(null);return e.current!=null&&e.current.lastElementChild.scrollIntoView(),u.jsx("div",{id:"chat",className:"w-full h-full overflow-y-auto p-2 relative",children:u.jsx("ul",{ref:e,children:t&&t.map((s,i)=>u.jsx(tt,{message:s},i))})})}function it(){const t=ce.map(e=>({width:150+Math.floor(150*Math.random()),color:e}));return u.jsx("div",{role:"status",className:"space-y-2.5 animate-pulse max-w p-4",children:t.map((e,s)=>u.jsxs("div",{className:"flex items-center w-full space-x-2",children:[u.jsx("div",{className:"h-6 bg-gray-200 rounded-full dark:bg-gray-700",style:{width:e.width,backgroundColor:e.color}}),u.jsx("div",{className:"h-6 bg-gray-300 rounded-full w-full"})]},s))})}var ee={},nt={get exports(){return ee},set exports(t){ee=t}};const ot={},rt=Object.freeze(Object.defineProperty({__proto__:null,default:ot},Symbol.toStringTag,{value:"Module"})),Oe=Be(rt);var M={},at={get exports(){return M},set exports(t){M=t}},ct=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function re(t){if(Array.isArray(t)){for(var e=0,s=Array(t.length);e<t.length;e++)s[e]=t[e];return s}else return Array.from(t)}var lt=/^\u0001ACTION ([^\u0001]+)\u0001$/,ut=/^(justinfan)(\d+$)/,ft=/\\([sn:r\\])/g,ye={s:" ",n:"",":":";",r:""},K=at.exports={get:function(e,s){return typeof e>"u"?s:e},isBoolean:function(e){return typeof e=="boolean"},isFinite:function(t){function e(s){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t){return isFinite(t)&&!isNaN(parseFloat(t))}),isInteger:function(e){return!isNaN(K.toNumber(e,0))},isJustinfan:function(e){return ut.test(e)},isNull:function(e){return e===null},isRegex:function(e){return/[\|\\\^\$\*\+\?\:\#]/.test(e)},isString:function(e){return typeof e=="string"},isURL:function(e){return new RegExp("^(?:(?:https?|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))\\.?)(?::\\d{2,5})?(?:[/?#]\\S*)?$","i").test(e)},justinfan:function(){return"justinfan"+Math.floor(Math.random()*8e4+1e3)},token:function(e){return e?e.toLowerCase().replace("oauth:",""):""},password:function(e){var s=K.token(e);return s?"oauth:"+s:""},promiseDelay:function(e){return new Promise(function(s){return setTimeout(s,e)})},replaceAll:function(e,s){if(e===null||typeof e>"u")return null;for(var i in s)e=e.replace(new RegExp(i,"g"),s[i]);return e},unescapeHtml:function(e){return e.replace(/\\&amp\\;/g,"&").replace(/\\&lt\\;/g,"<").replace(/\\&gt\\;/g,">").replace(/\\&quot\\;/g,'"').replace(/\\&#039\\;/g,"'")},unescapeIRC:function(e){return!e||!e.includes("\\")?e:e.replace(ft,function(s,i){return i in ye?ye[i]:i})},actionMessage:function(e){return e.match(lt)},addWord:function(e,s){return e.length?e+" "+s:e+s},channel:function(e){var s=(e||"").toLowerCase();return s[0]==="#"?s:"#"+s},extractNumber:function(e){for(var s=e.split(" "),i=0;i<s.length;i++)if(K.isInteger(s[i]))return~~s[i];return 0},formatDate:function(e){var s=e.getHours(),i=e.getMinutes();return s=(s<10?"0":"")+s,i=(i<10?"0":"")+i,s+":"+i},inherits:function(e,s){e.super_=s;var i=function(){};i.prototype=s.prototype,e.prototype=new i,e.prototype.constructor=e},isNode:function(){try{return(typeof process>"u"?"undefined":ct(process))==="object"&&Object.prototype.toString.call(process)==="[object process]"}catch{}return!1},isExtension:function(){try{return window.chrome&&chrome.runtime&&chrome.runtime.id}catch{}return!1},isReactNative:function(){try{return navigator&&navigator.product=="ReactNative"}catch{}return!1},merge:Object.assign,splitLine:function(e,s){var i=e.substring(0,s).lastIndexOf(" ");return i===-1&&(i=s-1),[e.substring(0,i),e.substring(i+1)]},toNumber:function(e,s){if(e===null)return 0;var i=Math.pow(10,K.isFinite(s)?s:0);return Math.round(e*i)/i},union:function(e,s){return[].concat(re(new Set([].concat(re(e),re(s)))))},username:function(e){var s=(e||"").toLowerCase();return s[0]==="#"?s.slice(1):s}},ht=Oe,L=M,mt=function(e,s){var i=e.url!==void 0?e.url:e.uri;if(L.isURL(i)||(i="https://api.twitch.tv/kraken"+(i[0]==="/"?i:"/"+i)),L.isNode()){var o=L.merge({method:"GET",json:!0},e,{url:i});ht(o,s)}else if(L.isExtension()||L.isReactNative()){e=L.merge({url:i,method:"GET",headers:{}},e);var a=new XMLHttpRequest;a.open(e.method,e.url,!0);for(var l in e.headers)a.setRequestHeader(l,e.headers[l]);a.responseType="json",a.addEventListener("load",function(g){a.readyState==4&&(a.status!=200?s(a.status,null,null):s(null,null,a.response))}),a.send()}else{var p=document.createElement("script"),c="jsonp_callback_"+Math.round(1e5*Math.random());window[c]=function(g){delete window[c],document.body.removeChild(p),s(null,null,g)},p.src=""+i+(i.includes("?")?"&":"?")+"callback="+c,document.body.appendChild(p)}},dt=mt,m=M;function we(t,e){var s=this;return t=m.channel(t),e=m.get(e,30),this._sendCommand(this._getPromiseDelay(),t,"/followers "+e,function(i,o){s.once("_promiseFollowers",function(a){a?o(a):i([t,~~e])})})}function xe(t){var e=this;return t=m.channel(t),this._sendCommand(this._getPromiseDelay(),t,"/followersoff",function(s,i){e.once("_promiseFollowersoff",function(o){o?i(o):s([t])})})}function Ce(t){var e=this;return t=m.channel(t),this._sendCommand(this._getPromiseDelay(),null,"PART "+t,function(s,i){e.once("_promisePart",function(o){o?i(o):s([t])})})}function ke(t){var e=this;return t=m.channel(t),this._sendCommand(this._getPromiseDelay(),t,"/r9kbeta",function(s,i){e.once("_promiseR9kbeta",function(o){o?i(o):s([t])})})}function Ne(t){var e=this;return t=m.channel(t),this._sendCommand(this._getPromiseDelay(),t,"/r9kbetaoff",function(s,i){e.once("_promiseR9kbetaoff",function(o){o?i(o):s([t])})})}function Te(t,e){var s=this;return t=m.channel(t),e=m.get(e,300),this._sendCommand(this._getPromiseDelay(),t,"/slow "+e,function(i,o){s.once("_promiseSlow",function(a){a?o(a):i([t,~~e])})})}function Ee(t){var e=this;return t=m.channel(t),this._sendCommand(this._getPromiseDelay(),t,"/slowoff",function(s,i){e.once("_promiseSlowoff",function(o){o?i(o):s([t])})})}var pt={action:function(e,s){return e=m.channel(e),s="ACTION "+s+"",this._sendMessage(this._getPromiseDelay(),e,s,function(i,o){i([e,s])})},ban:function(e,s,i){var o=this;return e=m.channel(e),s=m.username(s),i=m.get(i,""),this._sendCommand(this._getPromiseDelay(),e,"/ban "+s+" "+i,function(a,l){o.once("_promiseBan",function(p){p?l(p):a([e,s,i])})})},clear:function(e){var s=this;return e=m.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/clear",function(i,o){s.once("_promiseClear",function(a){a?o(a):i([e])})})},color:function(e,s){var i=this;return s=m.get(s,e),this._sendCommand(this._getPromiseDelay(),"#tmijs","/color "+s,function(o,a){i.once("_promiseColor",function(l){l?a(l):o([s])})})},commercial:function(e,s){var i=this;return e=m.channel(e),s=m.get(s,30),this._sendCommand(this._getPromiseDelay(),e,"/commercial "+s,function(o,a){i.once("_promiseCommercial",function(l){l?a(l):o([e,~~s])})})},deletemessage:function(e,s){var i=this;return e=m.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/delete "+s,function(o,a){i.once("_promiseDeletemessage",function(l){l?a(l):o([e])})})},emoteonly:function(e){var s=this;return e=m.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/emoteonly",function(i,o){s.once("_promiseEmoteonly",function(a){a?o(a):i([e])})})},emoteonlyoff:function(e){var s=this;return e=m.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/emoteonlyoff",function(i,o){s.once("_promiseEmoteonlyoff",function(a){a?o(a):i([e])})})},followersonly:we,followersmode:we,followersonlyoff:xe,followersmodeoff:xe,host:function(e,s){var i=this;return e=m.channel(e),s=m.username(s),this._sendCommand(2e3,e,"/host "+s,function(o,a){i.once("_promiseHost",function(l,p){l?a(l):o([e,s,~~p])})})},join:function(e){var s=this;return e=m.channel(e),this._sendCommand(null,null,"JOIN "+e,function(i,o){var a="_promiseJoin",l=!1,p=function g(x,v){e===m.channel(v)&&(s.removeListener(a,g),l=!0,x?o(x):i([e]))};s.on(a,p);var c=s._getPromiseDelay();m.promiseDelay(c).then(function(){l||s.emit(a,"No response from Twitch.",e)})})},mod:function(e,s){var i=this;return e=m.channel(e),s=m.username(s),this._sendCommand(this._getPromiseDelay(),e,"/mod "+s,function(o,a){i.once("_promiseMod",function(l){l?a(l):o([e,s])})})},mods:function(e){var s=this;return e=m.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/mods",function(i,o){s.once("_promiseMods",function(a,l){a?o(a):(l.forEach(function(p){s.moderators[e]||(s.moderators[e]=[]),s.moderators[e].includes(p)||s.moderators[e].push(p)}),i(l))})})},part:Ce,leave:Ce,ping:function(){var e=this;return this._sendCommand(this._getPromiseDelay(),null,"PING",function(s,i){e.latency=new Date,e.pingTimeout=setTimeout(function(){e.ws!==null&&(e.wasCloseCalled=!1,e.log.error("Ping timeout."),e.ws.close(),clearInterval(e.pingLoop),clearTimeout(e.pingTimeout))},m.get(e.opts.connection.timeout,9999)),e.once("_promisePing",function(o){return s([parseFloat(o)])})})},r9kbeta:ke,r9kmode:ke,r9kbetaoff:Ne,r9kmodeoff:Ne,raw:function(e){return this._sendCommand(this._getPromiseDelay(),null,e,function(s,i){s([e])})},say:function(e,s){return e=m.channel(e),s.startsWith(".")&&!s.startsWith("..")||s.startsWith("/")||s.startsWith("\\")?s.substr(1,3)==="me "?this.action(e,s.substr(4)):this._sendCommand(this._getPromiseDelay(),e,s,function(i,o){i([e,s])}):this._sendMessage(this._getPromiseDelay(),e,s,function(i,o){i([e,s])})},slow:Te,slowmode:Te,slowoff:Ee,slowmodeoff:Ee,subscribers:function(e){var s=this;return e=m.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/subscribers",function(i,o){s.once("_promiseSubscribers",function(a){a?o(a):i([e])})})},subscribersoff:function(e){var s=this;return e=m.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/subscribersoff",function(i,o){s.once("_promiseSubscribersoff",function(a){a?o(a):i([e])})})},timeout:function(e,s,i,o){var a=this;return e=m.channel(e),s=m.username(s),!m.isNull(i)&&!m.isInteger(i)&&(o=i,i=300),i=m.get(i,300),o=m.get(o,""),this._sendCommand(this._getPromiseDelay(),e,"/timeout "+s+" "+i+" "+o,function(l,p){a.once("_promiseTimeout",function(c){c?p(c):l([e,s,~~i,o])})})},unban:function(e,s){var i=this;return e=m.channel(e),s=m.username(s),this._sendCommand(this._getPromiseDelay(),e,"/unban "+s,function(o,a){i.once("_promiseUnban",function(l){l?a(l):o([e,s])})})},unhost:function(e){var s=this;return e=m.channel(e),this._sendCommand(2e3,e,"/unhost",function(i,o){s.once("_promiseUnhost",function(a){a?o(a):i([e])})})},unmod:function(e,s){var i=this;return e=m.channel(e),s=m.username(s),this._sendCommand(this._getPromiseDelay(),e,"/unmod "+s,function(o,a){i.once("_promiseUnmod",function(l){l?a(l):o([e,s])})})},unvip:function(e,s){var i=this;return e=m.channel(e),s=m.username(s),this._sendCommand(this._getPromiseDelay(),e,"/unvip "+s,function(o,a){i.once("_promiseUnvip",function(l){l?a(l):o([e,s])})})},vip:function(e,s){var i=this;return e=m.channel(e),s=m.username(s),this._sendCommand(this._getPromiseDelay(),e,"/vip "+s,function(o,a){i.once("_promiseVip",function(l){l?a(l):o([e,s])})})},vips:function(e){var s=this;return e=m.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/vips",function(i,o){s.once("_promiseVips",function(a,l){a?o(a):i(l)})})},whisper:function(e,s){var i=this;return e=m.username(e),e===this.getUsername()?Promise.reject("Cannot send a whisper to the same account."):this._sendCommand(this._getPromiseDelay(),"#tmijs","/w "+e+" "+s,function(o,a){var l=m.channel(e),p=m.merge({"message-type":"whisper","message-id":null,"thread-id":null,username:i.getUsername()},i.globaluserstate);i.emits(["whisper","message"],[[l,p,s,!0],[l,p,s,!0]]),o([e,s])})}},_t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};String.prototype.startsWith||(String.prototype.startsWith=function(t,e){return e=e||0,this.indexOf(t,e)===e});function w(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}var gt=w;w.EventEmitter=w;w.prototype._events=void 0;w.prototype._maxListeners=void 0;w.defaultMaxListeners=10;w.prototype.setMaxListeners=function(t){if(!vt(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this};w.prototype.emits=function(t,e){for(var s=0;s<t.length;s++){var i=s<e.length?e[s]:e[e.length-1];this.emit.apply(this,[t[s]].concat(i))}};w.prototype.emit=function(t){var e,s,i,o,a,l;if(this._events||(this._events={}),t==="error"&&(!this._events.error||Y(this._events.error)&&!this._events.error.length))throw e=arguments[1],e instanceof Error?e:TypeError('Uncaught, unspecified "error" event.');if(s=this._events[t],Re(s))return!1;if(O(s))switch(arguments.length){case 1:s.call(this);break;case 2:s.call(this,arguments[1]);break;case 3:s.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),s.apply(this,o)}else if(Y(s))for(o=Array.prototype.slice.call(arguments,1),l=s.slice(),i=l.length,a=0;a<i;a++)l[a].apply(this,o);return!0};w.prototype.addListener=function(t,e){var s;if(!O(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,O(e.listener)?e.listener:e),this._events[t]?Y(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,Y(this._events[t])&&!this._events[t].warned&&(Re(this._maxListeners)?s=w.defaultMaxListeners:s=this._maxListeners,s&&s>0&&this._events[t].length>s&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),typeof console.trace=="function"&&console.trace())),this};w.prototype.on=w.prototype.addListener;w.prototype.once=function(t,e){if(!O(e))throw TypeError("listener must be a function");var s=!1;if(this._events.hasOwnProperty(t)&&t.charAt(0)==="_"){var i=1,o=t;for(var a in this._events)this._events.hasOwnProperty(a)&&a.startsWith(o)&&i++;t=t+i}function l(){t.charAt(0)==="_"&&!isNaN(t.substr(t.length-1))&&(t=t.substring(0,t.length-1)),this.removeListener(t,l),s||(s=!0,e.apply(this,arguments))}return l.listener=e,this.on(t,l),this};w.prototype.removeListener=function(t,e){var s,i,o,a;if(!O(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(s=this._events[t],o=s.length,i=-1,s===e||O(s.listener)&&s.listener===e){if(delete this._events[t],this._events.hasOwnProperty(t+"2")&&t.charAt(0)==="_"){var l=t;for(var p in this._events)this._events.hasOwnProperty(p)&&p.startsWith(l)&&(isNaN(parseInt(p.substr(p.length-1)))||(this._events[t+parseInt(p.substr(p.length-1)-1)]=this._events[p],delete this._events[p]));this._events[t]=this._events[t+"1"],delete this._events[t+"1"]}this._events.removeListener&&this.emit("removeListener",t,e)}else if(Y(s)){for(a=o;a-- >0;)if(s[a]===e||s[a].listener&&s[a].listener===e){i=a;break}if(i<0)return this;s.length===1?(s.length=0,delete this._events[t]):s.splice(i,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this};w.prototype.removeAllListeners=function(t){var e,s;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[t]&&delete this._events[t],this;if(arguments.length===0){for(e in this._events)e!=="removeListener"&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(s=this._events[t],O(s))this.removeListener(t,s);else if(s)for(;s.length;)this.removeListener(t,s[s.length-1]);return delete this._events[t],this};w.prototype.listeners=function(t){var e;return!this._events||!this._events[t]?e=[]:O(this._events[t])?e=[this._events[t]]:e=this._events[t].slice(),e};w.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(O(e))return 1;if(e)return e.length}return 0};w.listenerCount=function(t,e){return t.listenerCount(e)};function O(t){return typeof t=="function"}function vt(t){return typeof t=="number"}function Y(t){return(typeof t>"u"?"undefined":_t(t))==="object"&&t!==null}function Re(t){return t===void 0}var bt=M,Ie="info",je={trace:0,debug:1,info:2,warn:3,error:4,fatal:5};function J(t){return function(e){je[t]>=je[Ie]&&console.log("["+bt.formatDate(new Date)+"] "+t+": "+e)}}var yt={setLevel:function(e){Ie=e},trace:J("trace"),debug:J("debug"),info:J("info"),warn:J("warn"),error:J("error"),fatal:J("fatal")},le=M,$=/\S+/g;function ae(t,e){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:",",i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"/",o=arguments[4],a=t[e];if(a===void 0)return t;var l=le.isString(a);if(t[e+"-raw"]=l?a:null,a===!0)return t[e]=null,t;if(t[e]={},l)for(var p=a.split(s),c=0;c<p.length;c++){var g=p[c].split(i),x=g[1];o!==void 0&&x&&(x=x.split(o)),t[e][g[0]]=x||null}return t}var wt={badges:function(e){return ae(e,"badges")},badgeInfo:function(e){return ae(e,"badge-info")},emotes:function(e){return ae(e,"emotes","/",":",",")},emoteRegex:function(e,s,i,o){$.lastIndex=0;for(var a=new RegExp("(\\b|^|s)"+le.unescapeHtml(s)+"(\\b|$|s)"),l;(l=$.exec(e))!==null;)a.test(l[0])&&(o[i]=o[i]||[],o[i].push([l.index,$.lastIndex-1]))},emoteString:function(e,s,i,o){$.lastIndex=0;for(var a;(a=$.exec(e))!==null;)a[0]===le.unescapeHtml(s)&&(o[i]=o[i]||[],o[i].push([a.index,$.lastIndex-1]))},transformEmotes:function(e){var s="";return Object.keys(e).forEach(function(i){s=s+i+":",e[i].forEach(function(o){return s=s+o.join("-")+","}),s=s.slice(0,-1)+"/"}),s.slice(0,-1)},msg:function(e){var s={raw:e,tags:{},prefix:null,command:null,params:[]},i=0,o=0;if(e.charCodeAt(0)===64){var o=e.indexOf(" ");if(o===-1)return null;for(var a=e.slice(1,o).split(";"),l=0;l<a.length;l++){var p=a[l],c=p.split("=");s.tags[c[0]]=p.substring(p.indexOf("=")+1)||!0}i=o+1}for(;e.charCodeAt(i)===32;)i++;if(e.charCodeAt(i)===58){if(o=e.indexOf(" ",i),o===-1)return null;for(s.prefix=e.slice(i+1,o),i=o+1;e.charCodeAt(i)===32;)i++}if(o=e.indexOf(" ",i),o===-1)return e.length>i?(s.command=e.slice(i),s):null;for(s.command=e.slice(i,o),i=o+1;e.charCodeAt(i)===32;)i++;for(;i<e.length;){if(o=e.indexOf(" ",i),e.charCodeAt(i)===58){s.params.push(e.slice(i+1));break}if(o!==-1){for(s.params.push(e.slice(i,o)),i=o+1;e.charCodeAt(i)===32;)i++;continue}if(o===-1){s.params.push(e.slice(i));break}}return s}},De={};function z(t){this.queue=[],this.index=0,this.defaultDelay=t||3e3}z.prototype.add=function(e,s){this.queue.push({fn:e,delay:s})};z.prototype.run=function(e){(e||e===0)&&(this.index=e),this.next()};z.prototype.next=function(){var e=this,s=this.index++,i=this.queue[s],o=this.queue[this.index];i&&(i.fn(),o&&setTimeout(function(){e.next()},o.delay||this.defaultDelay))};z.prototype.reset=function(){this.index=0};z.prototype.clear=function(){this.index=0,this.queue=[]};De.queue=z;(function(t){var e=dt,s=pt,i=gt.EventEmitter,o=yt,a=wt,l=De,p=ve.WebSocket||ve.MozWebSocket||Oe,c=M,g=function v(n){if(!(this instanceof v))return new v(n);this.setMaxListeners(0),this.opts=c.get(n,{}),this.opts.channels=this.opts.channels||[],this.opts.connection=this.opts.connection||{},this.opts.identity=this.opts.identity||{},this.opts.options=this.opts.options||{},this.clientId=c.get(this.opts.options.clientId,null),this.maxReconnectAttempts=c.get(this.opts.connection.maxReconnectAttempts,1/0),this.maxReconnectInterval=c.get(this.opts.connection.maxReconnectInterval,3e4),this.reconnect=c.get(this.opts.connection.reconnect,!1),this.reconnectDecay=c.get(this.opts.connection.reconnectDecay,1.5),this.reconnectInterval=c.get(this.opts.connection.reconnectInterval,1e3),this.reconnecting=!1,this.reconnections=0,this.reconnectTimer=this.reconnectInterval,this.secure=c.get(this.opts.connection.secure,!1),this.emotes="",this.emotesets={},this.channels=[],this.currentLatency=0,this.globaluserstate={},this.lastJoined="",this.latency=new Date,this.moderators={},this.pingLoop=null,this.pingTimeout=null,this.reason="",this.username="",this.userstate={},this.wasCloseCalled=!1,this.ws=null;var f="error";this.opts.options.debug&&(f="info"),this.log=this.opts.logger||o;try{o.setLevel(f)}catch{}this.opts.channels.forEach(function(r,h,d){d[h]=c.channel(r)}),i.call(this)};c.inherits(g,i),g.prototype.api=e;for(var x in s)g.prototype[x]=s[x];g.prototype.handleMessage=function(n){var f=this;if(!c.isNull(n)){this.emit("raw_message",JSON.parse(JSON.stringify(n)),n);var r=c.channel(c.get(n.params[0],null)),h=c.get(n.params[1],null),d=c.get(n.tags["msg-id"],null);if(n.tags=a.badges(a.badgeInfo(a.emotes(n.tags))),n.tags){var P=n.tags;for(var C in P)if(C!=="emote-sets"&&C!=="ban-duration"&&C!=="bits"){var b=P[C];c.isBoolean(b)?b=null:b==="1"?b=!0:b==="0"?b=!1:c.isString(b)&&(b=c.unescapeIRC(b)),P[C]=b}}if(c.isNull(n.prefix))switch(n.command){case"PING":this.emit("ping"),!c.isNull(this.ws)&&this.ws.readyState===1&&this.ws.send("PONG");break;case"PONG":var Q=new Date;this.currentLatency=(Q.getTime()-this.latency.getTime())/1e3,this.emits(["pong","_promisePing"],[[this.currentLatency]]),clearTimeout(this.pingTimeout);break;default:this.log.warn(`Could not parse message with no prefix:
`+JSON.stringify(n,null,4));break}else if(n.prefix==="tmi.twitch.tv")switch(n.command){case"002":case"003":case"004":case"375":case"376":case"CAP":break;case"001":this.username=n.params[0];break;case"372":this.log.info("Connected to server."),this.userstate["#tmijs"]={},this.emits(["connected","_promiseConnect"],[[this.server,this.port],[null]]),this.reconnections=0,this.reconnectTimer=this.reconnectInterval,this.pingLoop=setInterval(function(){!c.isNull(f.ws)&&f.ws.readyState===1&&f.ws.send("PING"),f.latency=new Date,f.pingTimeout=setTimeout(function(){c.isNull(f.ws)||(f.wasCloseCalled=!1,f.log.error("Ping timeout."),f.ws.close(),clearInterval(f.pingLoop),clearTimeout(f.pingTimeout))},c.get(f.opts.connection.timeout,9999))},6e4);var G=new l.queue(2e3),I=c.union(this.opts.channels,this.channels);this.channels=[];for(var H=function(){var We=I[W];G.add(function(){!c.isNull(f.ws)&&f.ws.readyState===1&&f.join(We).catch(function(qe){return f.log.error(qe)})})},W=0;W<I.length;W++)H();G.run();break;case"NOTICE":var T=[null],E=[r,d,h],Me=[d],q=[r,!0],B=[r,!1],j=[E,T],y=[E,Me],_="["+r+"] "+h;switch(d){case"subs_on":this.log.info("["+r+"] This room is now in subscribers-only mode."),this.emits(["subscriber","subscribers","_promiseSubscribers"],[q,q,T]);break;case"subs_off":this.log.info("["+r+"] This room is no longer in subscribers-only mode."),this.emits(["subscriber","subscribers","_promiseSubscribersoff"],[B,B,T]);break;case"emote_only_on":this.log.info("["+r+"] This room is now in emote-only mode."),this.emits(["emoteonly","_promiseEmoteonly"],[q,T]);break;case"emote_only_off":this.log.info("["+r+"] This room is no longer in emote-only mode."),this.emits(["emoteonly","_promiseEmoteonlyoff"],[B,T]);break;case"slow_on":case"slow_off":break;case"followers_on_zero":case"followers_on":case"followers_off":break;case"r9k_on":this.log.info("["+r+"] This room is now in r9k mode."),this.emits(["r9kmode","r9kbeta","_promiseR9kbeta"],[q,q,T]);break;case"r9k_off":this.log.info("["+r+"] This room is no longer in r9k mode."),this.emits(["r9kmode","r9kbeta","_promiseR9kbetaoff"],[B,B,T]);break;case"room_mods":var ue=h.split(": ")[1].toLowerCase().split(", ").filter(function(U){return U});this.emits(["_promiseMods","mods"],[[null,ue],[r,ue]]);break;case"no_mods":this.emits(["_promiseMods","mods"],[[null,[]],[r,[]]]);break;case"vips_success":h.endsWith(".")&&(h=h.slice(0,-1));var fe=h.split(": ")[1].toLowerCase().split(", ").filter(function(U){return U});this.emits(["_promiseVips","vips"],[[null,fe],[r,fe]]);break;case"no_vips":this.emits(["_promiseVips","vips"],[[null,[]],[r,[]]]);break;case"already_banned":case"bad_ban_admin":case"bad_ban_broadcaster":case"bad_ban_global_mod":case"bad_ban_self":case"bad_ban_staff":case"usage_ban":this.log.info(_),this.emits(["notice","_promiseBan"],y);break;case"ban_success":this.log.info(_),this.emits(["notice","_promiseBan"],j);break;case"usage_clear":this.log.info(_),this.emits(["notice","_promiseClear"],y);break;case"usage_mods":this.log.info(_),this.emits(["notice","_promiseMods"],[E,[d,[]]]);break;case"mod_success":this.log.info(_),this.emits(["notice","_promiseMod"],j);break;case"usage_vips":this.log.info(_),this.emits(["notice","_promiseVips"],[E,[d,[]]]);break;case"usage_vip":case"bad_vip_grantee_banned":case"bad_vip_grantee_already_vip":case"bad_vip_achievement_incomplete":this.log.info(_),this.emits(["notice","_promiseVip"],[E,[d,[]]]);break;case"vip_success":this.log.info(_),this.emits(["notice","_promiseVip"],j);break;case"usage_mod":case"bad_mod_banned":case"bad_mod_mod":this.log.info(_),this.emits(["notice","_promiseMod"],y);break;case"unmod_success":this.log.info(_),this.emits(["notice","_promiseUnmod"],j);break;case"unvip_success":this.log.info(_),this.emits(["notice","_promiseUnvip"],j);break;case"usage_unmod":case"bad_unmod_mod":this.log.info(_),this.emits(["notice","_promiseUnmod"],y);break;case"usage_unvip":case"bad_unvip_grantee_not_vip":this.log.info(_),this.emits(["notice","_promiseUnvip"],y);break;case"color_changed":this.log.info(_),this.emits(["notice","_promiseColor"],j);break;case"usage_color":case"turbo_only_color":this.log.info(_),this.emits(["notice","_promiseColor"],y);break;case"commercial_success":this.log.info(_),this.emits(["notice","_promiseCommercial"],j);break;case"usage_commercial":case"bad_commercial_error":this.log.info(_),this.emits(["notice","_promiseCommercial"],y);break;case"hosts_remaining":this.log.info(_);var Ue=isNaN(h[0])?0:parseInt(h[0]);this.emits(["notice","_promiseHost"],[E,[null,~~Ue]]);break;case"bad_host_hosting":case"bad_host_rate_exceeded":case"bad_host_error":case"usage_host":this.log.info(_),this.emits(["notice","_promiseHost"],[E,[d,null]]);break;case"already_r9k_on":case"usage_r9k_on":this.log.info(_),this.emits(["notice","_promiseR9kbeta"],y);break;case"already_r9k_off":case"usage_r9k_off":this.log.info(_),this.emits(["notice","_promiseR9kbetaoff"],y);break;case"timeout_success":this.log.info(_),this.emits(["notice","_promiseTimeout"],j);break;case"delete_message_success":this.log.info("["+r+" "+h+"]"),this.emits(["notice","_promiseDeletemessage"],j);case"already_subs_off":case"usage_subs_off":this.log.info(_),this.emits(["notice","_promiseSubscribersoff"],y);break;case"already_subs_on":case"usage_subs_on":this.log.info(_),this.emits(["notice","_promiseSubscribers"],y);break;case"already_emote_only_off":case"usage_emote_only_off":this.log.info(_),this.emits(["notice","_promiseEmoteonlyoff"],y);break;case"already_emote_only_on":case"usage_emote_only_on":this.log.info(_),this.emits(["notice","_promiseEmoteonly"],y);break;case"usage_slow_on":this.log.info(_),this.emits(["notice","_promiseSlow"],y);break;case"usage_slow_off":this.log.info(_),this.emits(["notice","_promiseSlowoff"],y);break;case"usage_timeout":case"bad_timeout_admin":case"bad_timeout_broadcaster":case"bad_timeout_duration":case"bad_timeout_global_mod":case"bad_timeout_self":case"bad_timeout_staff":this.log.info(_),this.emits(["notice","_promiseTimeout"],y);break;case"untimeout_success":case"unban_success":this.log.info(_),this.emits(["notice","_promiseUnban"],j);break;case"usage_unban":case"bad_unban_no_ban":this.log.info(_),this.emits(["notice","_promiseUnban"],y);break;case"usage_delete":case"bad_delete_message_error":case"bad_delete_message_broadcaster":case"bad_delete_message_mod":this.log.info(_),this.emits(["notice","_promiseDeletemessage"],y);break;case"usage_unhost":case"not_hosting":this.log.info(_),this.emits(["notice","_promiseUnhost"],y);break;case"whisper_invalid_login":case"whisper_invalid_self":case"whisper_limit_per_min":case"whisper_limit_per_sec":case"whisper_restricted":case"whisper_restricted_recipient":this.log.info(_),this.emits(["notice","_promiseWhisper"],y);break;case"no_permission":case"msg_banned":case"msg_room_not_found":case"msg_channel_suspended":case"tos_ban":this.log.info(_),this.emits(["notice","_promiseBan","_promiseClear","_promiseUnban","_promiseTimeout","_promiseDeletemessage","_promiseMods","_promiseMod","_promiseUnmod","_promiseVips","_promiseVip","_promiseUnvip","_promiseCommercial","_promiseHost","_promiseUnhost","_promiseJoin","_promisePart","_promiseR9kbeta","_promiseR9kbetaoff","_promiseSlow","_promiseSlowoff","_promiseFollowers","_promiseFollowersoff","_promiseSubscribers","_promiseSubscribersoff","_promiseEmoteonly","_promiseEmoteonlyoff"],[E,[d,r]]);break;case"msg_rejected":case"msg_rejected_mandatory":this.log.info(_),this.emit("automod",r,d,h);break;case"unrecognized_cmd":this.log.info(_),this.emit("notice",r,d,h);break;case"cmds_available":case"host_target_went_offline":case"msg_censored_broadcaster":case"msg_duplicate":case"msg_emoteonly":case"msg_verified_email":case"msg_ratelimit":case"msg_subsonly":case"msg_timedout":case"msg_bad_characters":case"msg_channel_blocked":case"msg_facebook":case"msg_followersonly":case"msg_followersonly_followed":case"msg_followersonly_zero":case"msg_slowmode":case"msg_suspended":case"no_help":case"usage_disconnect":case"usage_help":case"usage_me":this.log.info(_),this.emit("notice",r,d,h);break;case"host_on":case"host_off":break;default:h.includes("Login unsuccessful")||h.includes("Login authentication failed")?(this.wasCloseCalled=!1,this.reconnect=!1,this.reason=h,this.log.error(this.reason),this.ws.close()):h.includes("Error logging in")||h.includes("Improperly formatted auth")?(this.wasCloseCalled=!1,this.reconnect=!1,this.reason=h,this.log.error(this.reason),this.ws.close()):h.includes("Invalid NICK")?(this.wasCloseCalled=!1,this.reconnect=!1,this.reason="Invalid NICK.",this.log.error(this.reason),this.ws.close()):(this.log.warn(`Could not parse NOTICE from tmi.twitch.tv:
`+JSON.stringify(n,null,4)),this.emit("notice",r,d,h));break}break;case"USERNOTICE":var N=n.tags["display-name"]||n.tags.login,he=n.tags["msg-param-sub-plan"]||"",Le=c.unescapeIRC(c.get(n.tags["msg-param-sub-plan-name"],""))||null,Je=he.includes("Prime"),D={prime:Je,plan:he,planName:Le},k=n.tags,se=~~(n.tags["msg-param-streak-months"]||0),me=n.tags["msg-param-recipient-display-name"]||n.tags["msg-param-recipient-user-name"],de=~~n.tags["msg-param-mass-gift-count"];switch(k["message-type"]=d,d){case"resub":this.emits(["resub","subanniversary"],[[r,N,se,h,k,D]]);break;case"sub":this.emit("subscription",r,N,D,h,k);break;case"subgift":this.emit("subgift",r,N,se,me,D,k);break;case"anonsubgift":this.emit("anonsubgift",r,se,me,D,k);break;case"submysterygift":this.emit("submysterygift",r,N,de,D,k);break;case"anonsubmysterygift":this.emit("anonsubmysterygift",r,de,D,k);break;case"primepaidupgrade":this.emit("primepaidupgrade",r,N,D,k);break;case"giftpaidupgrade":var $e=n.tags["msg-param-sender-name"]||n.tags["msg-param-sender-login"];this.emit("giftpaidupgrade",r,N,$e,k);break;case"anongiftpaidupgrade":this.emit("anongiftpaidupgrade",r,N,k);break;case"raid":var N=n.tags["msg-param-displayName"]||n.tags["msg-param-login"],F=n.tags["msg-param-viewerCount"];this.emit("raided",r,N,F);break}break;case"HOSTTARGET":var Z=h.split(" "),F=~~Z[1]||0;Z[0]==="-"?(this.log.info("["+r+"] Exited host mode."),this.emits(["unhost","_promiseUnhost"],[[r,F],[null]])):(this.log.info("["+r+"] Now hosting "+Z[0]+" for "+F+" viewer(s)."),this.emit("hosting",r,Z[0],F));break;case"CLEARCHAT":if(n.params.length>1){var ie=c.get(n.tags["ban-duration"],null);c.isNull(ie)?(this.log.info("["+r+"] "+h+" has been banned."),this.emit("ban",r,h,null,n.tags)):(this.log.info("["+r+"] "+h+" has been timed out for "+ie+" seconds."),this.emit("timeout",r,h,null,~~ie,n.tags))}else this.log.info("["+r+"] Chat was cleared by a moderator."),this.emits(["clearchat","_promiseClear"],[[r],[null]]);break;case"CLEARMSG":if(n.params.length>1){var N=n.tags.login,ze=h,k=n.tags;k["message-type"]="messagedeleted",this.log.info("["+r+"] "+N+"'s message has been deleted."),this.emit("messagedeleted",r,N,ze,k)}break;case"RECONNECT":this.log.info("Received RECONNECT request from Twitch.."),this.log.info("Disconnecting and reconnecting in "+Math.round(this.reconnectTimer/1e3)+" seconds.."),this.disconnect(),setTimeout(function(){return f.connect()},this.reconnectTimer);break;case"USERSTATE":n.tags.username=this.username,n.tags["user-type"]==="mod"&&(this.moderators[this.lastJoined]||(this.moderators[this.lastJoined]=[]),this.moderators[this.lastJoined].includes(this.username)||this.moderators[this.lastJoined].push(this.username)),!c.isJustinfan(this.getUsername())&&!this.userstate[r]&&(this.userstate[r]=n.tags,this.lastJoined=r,this.channels.push(r),this.log.info("Joined "+r),this.emit("join",r,c.username(this.getUsername()),!0)),this.userstate[r]=n.tags;break;case"GLOBALUSERSTATE":this.globaluserstate=n.tags,typeof n.tags["emote-sets"]<"u";break;case"ROOMSTATE":if(c.channel(this.lastJoined)===r&&this.emit("_promiseJoin",null,r),n.tags.channel=r,this.emit("roomstate",r,n.tags),!n.tags.hasOwnProperty("subs-only")){if(n.tags.hasOwnProperty("slow"))if(typeof n.tags.slow=="boolean"&&!n.tags.slow){var V=[r,!1,0];this.log.info("["+r+"] This room is no longer in slow mode."),this.emits(["slow","slowmode","_promiseSlowoff"],[V,V,[null]])}else{var ne=~~n.tags.slow,A=[r,!0,ne];this.log.info("["+r+"] This room is now in slow mode."),this.emits(["slow","slowmode","_promiseSlow"],[A,A,[null]])}if(n.tags.hasOwnProperty("followers-only"))if(n.tags["followers-only"]==="-1"){var V=[r,!1,0];this.log.info("["+r+"] This room is no longer in followers-only mode."),this.emits(["followersonly","followersmode","_promiseFollowersoff"],[V,V,[null]])}else{var ne=~~n.tags["followers-only"],A=[r,!0,ne];this.log.info("["+r+"] This room is now in follower-only mode."),this.emits(["followersonly","followersmode","_promiseFollowers"],[A,A,[null]])}}break;case"SERVERCHANGE":break;default:this.log.warn(`Could not parse message from tmi.twitch.tv:
`+JSON.stringify(n,null,4));break}else if(n.prefix==="jtv")switch(n.command){case"MODE":h==="+o"?(this.moderators[r]||(this.moderators[r]=[]),this.moderators[r].includes(n.params[2])||this.moderators[r].push(n.params[2]),this.emit("mod",r,n.params[2])):h==="-o"&&(this.moderators[r]||(this.moderators[r]=[]),this.moderators[r].filter(function(U){return U!=n.params[2]}),this.emit("unmod",r,n.params[2]));break;default:this.log.warn(`Could not parse message from jtv:
`+JSON.stringify(n,null,4));break}else switch(n.command){case"353":this.emit("names",n.params[2],n.params[3].split(" "));break;case"366":break;case"JOIN":var S=n.prefix.split("!")[0];c.isJustinfan(this.getUsername())&&this.username===S&&(this.lastJoined=r,this.channels.push(r),this.log.info("Joined "+r),this.emit("join",r,S,!0)),this.username!==S&&this.emit("join",r,S,!1);break;case"PART":var pe=!1,S=n.prefix.split("!")[0];if(this.username===S){pe=!0,this.userstate[r]&&delete this.userstate[r];var X=this.channels.indexOf(r);X!==-1&&this.channels.splice(X,1);var X=this.opts.channels.indexOf(r);X!==-1&&this.opts.channels.splice(X,1),this.log.info("Left "+r),this.emit("_promisePart",null)}this.emit("part",r,S,pe);break;case"WHISPER":var S=n.prefix.split("!")[0];this.log.info("[WHISPER] <"+S+">: "+h),n.tags.hasOwnProperty("username")||(n.tags.username=S),n.tags["message-type"]="whisper";var Ge=c.channel(n.tags.username);this.emits(["whisper","message"],[[Ge,n.tags,h,!1]]);break;case"PRIVMSG":if(n.tags.username=n.prefix.split("!")[0],n.tags.username==="jtv"){var _e=c.username(h.split(" ")[0]),ge=h.includes("auto");if(h.includes("hosting you for")){var He=c.extractNumber(h);this.emit("hosted",r,_e,He,ge)}else h.includes("hosting you")&&this.emit("hosted",r,_e,0,ge)}else{var oe=c.actionMessage(h);oe?(n.tags["message-type"]="action",this.log.info("["+r+"] *<"+n.tags.username+">: "+oe[1]),this.emits(["action","message"],[[r,n.tags,oe[1],!1]])):n.tags.hasOwnProperty("bits")?this.emit("cheer",r,n.tags,h):(n.tags["message-type"]="chat",this.log.info("["+r+"] <"+n.tags.username+">: "+h),this.emits(["chat","message"],[[r,n.tags,h,!1]]))}break;default:this.log.warn(`Could not parse message:
`+JSON.stringify(n,null,4));break}}},g.prototype.connect=function(){var n=this;return new Promise(function(f,r){n.server=c.get(n.opts.connection.server,"irc-ws.chat.twitch.tv"),n.port=c.get(n.opts.connection.port,80),n.secure&&(n.port=443),n.port===443&&(n.secure=!0),n.reconnectTimer=n.reconnectTimer*n.reconnectDecay,n.reconnectTimer>=n.maxReconnectInterval&&(n.reconnectTimer=n.maxReconnectInterval),n._openConnection(),n.once("_promiseConnect",function(h){h?r(h):f([n.server,~~n.port])})})},g.prototype._openConnection=function(){this.ws=new p((this.secure?"wss":"ws")+"://"+this.server+":"+this.port+"/","irc"),this.ws.onmessage=this._onMessage.bind(this),this.ws.onerror=this._onError.bind(this),this.ws.onclose=this._onClose.bind(this),this.ws.onopen=this._onOpen.bind(this)},g.prototype._onOpen=function(){var n=this;c.isNull(this.ws)||this.ws.readyState!==1||(this.log.info("Connecting to "+this.server+" on port "+this.port+".."),this.emit("connecting",this.server,~~this.port),this.username=c.get(this.opts.identity.username,c.justinfan()),this._getToken().then(function(f){var r=c.password(f);n.log.info("Sending authentication to server.."),n.emit("logon"),n.ws.send("CAP REQ :twitch.tv/tags twitch.tv/commands twitch.tv/membership"),r&&n.ws.send("PASS "+r),n.ws.send("NICK "+n.username)}).catch(function(f){n.emits(["_promiseConnect","disconnected"],[[f],["Could not get a token."]])}))},g.prototype._getToken=function(){var n=this.opts.identity.password,f=void 0;return typeof n=="function"?(f=n(),f instanceof Promise?f:Promise.resolve(f)):Promise.resolve(n)},g.prototype._onMessage=function(n){var f=this,r=n.data.split(`\r
`);r.forEach(function(h){c.isNull(h)||f.handleMessage(a.msg(h))})},g.prototype._onError=function(){var n=this;this.moderators={},this.userstate={},this.globaluserstate={},clearInterval(this.pingLoop),clearTimeout(this.pingTimeout),this.reason=c.isNull(this.ws)?"Connection closed.":"Unable to connect.",this.emits(["_promiseConnect","disconnected"],[[this.reason]]),this.reconnect&&this.reconnections===this.maxReconnectAttempts&&(this.emit("maxreconnect"),this.log.error("Maximum reconnection attempts reached.")),this.reconnect&&!this.reconnecting&&this.reconnections<=this.maxReconnectAttempts-1&&(this.reconnecting=!0,this.reconnections=this.reconnections+1,this.log.error("Reconnecting in "+Math.round(this.reconnectTimer/1e3)+" seconds.."),this.emit("reconnect"),setTimeout(function(){n.reconnecting=!1,n.connect()},this.reconnectTimer)),this.ws=null},g.prototype._onClose=function(){var n=this;this.moderators={},this.userstate={},this.globaluserstate={},clearInterval(this.pingLoop),clearTimeout(this.pingTimeout),this.wasCloseCalled?(this.wasCloseCalled=!1,this.reason="Connection closed.",this.log.info(this.reason),this.emits(["_promiseConnect","_promiseDisconnect","disconnected"],[[this.reason],[null],[this.reason]])):(this.emits(["_promiseConnect","disconnected"],[[this.reason]]),this.reconnect&&this.reconnections===this.maxReconnectAttempts&&(this.emit("maxreconnect"),this.log.error("Maximum reconnection attempts reached.")),this.reconnect&&!this.reconnecting&&this.reconnections<=this.maxReconnectAttempts-1&&(this.reconnecting=!0,this.reconnections=this.reconnections+1,this.log.error("Could not connect to server. Reconnecting in "+Math.round(this.reconnectTimer/1e3)+" seconds.."),this.emit("reconnect"),setTimeout(function(){n.reconnecting=!1,n.connect()},this.reconnectTimer))),this.ws=null},g.prototype._getPromiseDelay=function(){return this.currentLatency<=600?600:this.currentLatency+100},g.prototype._sendCommand=function(n,f,r,h){var d=this;return new Promise(function(P,C){if(c.isNull(d.ws)||d.ws.readyState!==1)return C("Not connected to server.");if(typeof n=="number"&&c.promiseDelay(n).then(function(){return C("No response from Twitch.")}),c.isNull(f))d.log.info("Executing command: "+r),d.ws.send(r);else{var b=c.channel(f);d.log.info("["+b+"] Executing command: "+r),d.ws.send("PRIVMSG "+b+" :"+r)}h(P,C)})},g.prototype._sendMessage=function(n,f,r,h){var d=this;return new Promise(function(P,C){if(c.isNull(d.ws)||d.ws.readyState!==1)return C("Not connected to server.");if(c.isJustinfan(d.getUsername()))return C("Cannot send anonymous messages.");var b=c.channel(f);if(d.userstate[b]||(d.userstate[b]={}),r.length>=500){var Q=c.splitLine(r,500);r=Q[0],setTimeout(function(){d._sendMessage(n,f,Q[1],function(){})},350)}d.ws.send("PRIVMSG "+b+" :"+r);var G={};Object.keys(d.emotesets).forEach(function(W){return d.emotesets[W].forEach(function(T){var E=c.isRegex(T.code)?a.emoteRegex:a.emoteString;return E(r,T.code,T.id,G)})});var I=c.merge(d.userstate[b],a.emotes({emotes:a.transformEmotes(G)||null})),H=c.actionMessage(r);H?(I["message-type"]="action",d.log.info("["+b+"] *<"+d.getUsername()+">: "+H[1]),d.emits(["action","message"],[[b,I,H[1],!0]])):(I["message-type"]="chat",d.log.info("["+b+"] <"+d.getUsername()+">: "+r),d.emits(["chat","message"],[[b,I,r,!0]])),h(P,C)})},g.prototype._updateEmoteset=function(n){var f=this;this.emotes=n,this._getToken().then(function(r){return f.api({url:"/chat/emoticon_images?emotesets="+n,headers:{Authorization:"OAuth "+c.token(r),"Client-ID":f.clientId}},function(h,d,P){if(!h)return f.emotesets=P.emoticon_sets||{},f.emit("emotesets",n,f.emotesets);setTimeout(function(){return f._updateEmoteset(n)},6e4)})}).catch(function(){return setTimeout(function(){return f._updateEmoteset(n)},6e4)})},g.prototype.getUsername=function(){return this.username},g.prototype.getOptions=function(){return this.opts},g.prototype.getChannels=function(){return this.channels},g.prototype.isMod=function(n,f){var r=c.channel(n);return this.moderators[r]||(this.moderators[r]=[]),this.moderators[r].includes(c.username(f))},g.prototype.readyState=function(){return c.isNull(this.ws)?"CLOSED":["CONNECTING","OPEN","CLOSING","CLOSED"][this.ws.readyState]},g.prototype.disconnect=function(){var n=this;return new Promise(function(f,r){!c.isNull(n.ws)&&n.ws.readyState!==3?(n.wasCloseCalled=!0,n.log.info("Disconnecting from server.."),n.ws.close(),n.once("_promiseDisconnect",function(){return f([n.server,~~n.port])})):(n.log.error("Cannot disconnect from server. Socket is not opened or connection is already closing."),r("Cannot disconnect from server. Socket is not opened or connection is already closing."))})},t.exports&&(t.exports=g),typeof window<"u"&&(window.tmi={},window.tmi.client=g,window.tmi.Client=g)})(nt);var xt={client:ee,Client:ee};async function Ct(t){const e=JSON.stringify({message:t}),s={method:"POST",headers:{"Content-Type":"application/json"},body:e};return await(await fetch(`${Se}/classify`,s)).json()}function kt({userName:t}){let[e,s]=R.useState([]);const[i,o]=R.useState(!1);R.useState(t);const a=new xt.Client({channels:[t],connection:{secure:!0}});return R.useEffect(()=>{i||a.connect().catch(l=>{console.log(l)}),a.on("message",(l,p,c,g)=>{if(g)return;const x=ce[Math.floor(Math.random()*ce.length)],v={message:c,userName:p["display-name"],color:x},n=e.filter(f=>f.message===c&&f.userName===v.userName).length===0;Ct(c).then(f=>{o(!0),v.classified=f,n&&(e=[...e.slice(-Fe),v]),s(e)}).catch(f=>{console.log(f)})})},[e]),{messages:e,chatConnected:i}}function Nt({userName:t}){const{messages:e,chatConnected:s}=kt({userName:t});return s?u.jsxs("div",{className:"w-full h-screen flex flex-col bg-[#f5f6fa]",children:[u.jsx(be,{userName:t}),u.jsx(st,{messages:e})]}):u.jsxs("div",{className:"w-full h-screen flex flex-col bg-[#f5f6fa]",children:[u.jsx(be,{userName:t}),u.jsx(it,{})]})}function Tt(){return u.jsx("div",{className:"flex min-h-full justify-center py-12 px-4 sm:px-6 lg:px-8",children:u.jsx("div",{className:"w-full max-w-md space-y-8",children:u.jsxs("form",{className:"mt-8 space-y-6",type:"get",autoComplete:"off",children:[u.jsxs("h3",{className:"text-center font-black text-white text-3xl pt-10 pb-6",children:["Twitch ☣️Toxic ",u.jsx("p",{className:"text-5xl",children:"Tracker"})]}),u.jsx("p",{className:"text-center font-light text-white text-md pb-3",children:"Toxic messages can be harmful to the streamer and the community, and often include hate speech, bullying, and harassment. This app uses advanced natural language processing techniques to identify toxic messages and flag them for the streamer's attention"}),u.jsx("p",{className:"text-center font-light text-white text-md pb-6",children:"Add one Twitch streamer user name to track his chat"}),u.jsxs("div",{className:"flex rounded-md shadow-sm",children:[u.jsx("span",{className:"inline-flex items-center rounded-l-md border border-r-0 border-gray-300 bg-gray-50 px-3 text-sm text-gray-500",children:"@"}),u.jsx("input",{type:"text",name:"username",id:"username",className:"relative block w-full appearance-none rounded-r-md border border-gray-300 px-3 py-2 text-gray-900 placeholder-gray-500 focus:z-10 focus:border-indigo-500 focus:outline-none focus:ring-indigo-500 sm:text-sm",placeholder:"Twitch Username (e.g. thegrefg)"})]}),u.jsx("div",{children:u.jsxs("button",{type:"submit",className:"group relative flex w-full justify-center rounded-md border border-transparent bg-indigo-600 py-2 px-4 text-sm font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",children:[u.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3",children:u.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",children:u.jsx("path",{d:"M2.149 0l-1.612 4.119v16.836h5.731v3.045h3.224l3.045-3.045h4.657l6.269-6.269v-14.686h-21.314zm19.164 13.612l-3.582 3.582h-5.731l-3.045 3.045v-3.045h-4.836v-15.045h17.194v11.463zm-3.582-7.343v6.262h-2.149v-6.262h2.149zm-5.731 0v6.262h-2.149v-6.262h2.149z"})})}),"Read Chat"]})})]})})})}function jt(){const t=new URLSearchParams(window.location.search),s=Object.fromEntries(t.entries()).username||"midudev";return u.jsxs("div",{className:"grid grid-cols-12",children:[u.jsx("div",{className:"hidden lg:block col-span-12 lg:col-span-6 xl:col-start-2 xl:col-end-5",children:u.jsx(Tt,{})}),u.jsx("div",{className:"col-span-12 lg:col-span-6 xl:col-start-6 xl:col-end-10",children:u.jsx(Nt,{userName:s})})]})}export{jt as default};
